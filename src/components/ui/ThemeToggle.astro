<button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" stroke-linecap="round">
    <defs>
      <clipPath id="theme-clip">
        <path class="theme-clip-path" d="M0-5h30a1 1 0 0 0 9 13v24H0Z" />
      </clipPath>
    </defs>
    <g clip-path="url(#theme-clip)">
      <circle class="theme-circle" cx="16" cy="16" r="8" />
      <g class="theme-rays" stroke="currentColor" stroke-width="1.5" fill="none">
        <path d="M16 5.5v-4" />
        <path d="M16 30.5v-4" />
        <path d="M1.5 16h4" />
        <path d="M26.5 16h4" />
        <path d="m23.4 8.6 2.8-2.8" />
        <path d="m5.7 26.3 2.9-2.9" />
        <path d="m5.8 5.8 2.8 2.8" />
        <path d="m23.4 23.4 2.9 2.9" />
      </g>
    </g>
  </svg>
</button>

<script is:inline>
  (function() {
    var toggle = document.getElementById('theme-toggle');
    toggle.addEventListener('click', function() {
      var rect = toggle.getBoundingClientRect();
      var x = rect.left + rect.width / 2;
      var y = rect.top + rect.height / 2;
      var maxRadius = Math.hypot(
        Math.max(x, window.innerWidth - x),
        Math.max(y, window.innerHeight - y)
      );

      if (!document.startViewTransition) {
        var isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        return;
      }

      var transition = document.startViewTransition(function() {
        var isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });

      transition.ready.then(function() {
        document.documentElement.animate(
          { clipPath: [
            'circle(0px at ' + x + 'px ' + y + 'px)',
            'circle(' + maxRadius + 'px at ' + x + 'px ' + y + 'px)'
          ]},
          { duration: 600, easing: 'cubic-bezier(0.4, 0, 0.2, 1)', pseudoElement: '::view-transition-new(root)' }
        );
      });
    });
  })();
</script>
