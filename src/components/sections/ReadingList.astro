---
import { getCollection } from 'astro:content';
import SectionHeader from '../ui/SectionHeader.astro';

const allReading = await getCollection('reading');
const books = allReading.filter((r) => r.data.type === 'book');
const blogs = allReading.filter((r) => r.data.type === 'blog');
const videos = allReading.filter((r) => r.data.type === 'video');

const typeLabels: Record<string, { cta: string }> = {
  book: { cta: 'link →' },
  blog: { cta: 'read →' },
  video: { cta: 'watch →' },
};
---

<section class="fade-on-scroll">
  <SectionHeader title="reading list" />
  <div class="space-y-8">
    {[
      { label: 'books', items: books },
      { label: 'blogs', items: blogs },
      { label: 'videos', items: videos },
    ].map(({ label, items }) => (
      <div>
        <h3 class="font-mono text-xs mb-4" style="color: var(--text-tertiary);">{label}</h3>
        <div class="space-y-4">
          {items.map((item) => (
            <div class="flex flex-col md:flex-row md:items-baseline gap-2 md:gap-8">
              <div class="grow">
                <a href={`/reading/${item.slug}`} class="no-underline group">
                  <h4 class="font-semibold text-text-primary transition-colors underline decoration-transparent group-hover:decoration-current underline-offset-4 group-hover:text-accent-blue">{item.data.title}</h4>
                </a>
                <p class="text-sm mt-1" style="color: var(--text-tertiary);">
                  {item.data.author}
                  {item.data.status === 'reading' && ' · currently reading'}
                  {item.data.status === 'on-deck' && ' · on deck'}
                  {item.data.duration && ` · ${item.data.duration}`}
                </p>
              </div>
              <a
                href={item.data.url}
                target="_blank"
                rel="noopener noreferrer"
                class="font-mono text-xs text-text-tertiary transition-colors shrink-0 no-underline hover:text-accent hover:underline underline-offset-4"
              >
                {typeLabels[item.data.type].cta}
              </a>
            </div>
          ))}
        </div>
      </div>
    ))}
  </div>
  <div class="mt-12 md:mt-16 text-center">
    <a href="/reading" class="inline-flex items-center gap-2 font-mono text-sm transition-colors border-b pb-1 hover-link">
      reading archive →
    </a>
  </div>
</section>
